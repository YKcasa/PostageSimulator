<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>郵便料金シミュレーション ver0.9</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="header">
            <h3>郵便料金シミュレーション　β版</h3>
        </div>
        <div class="container">
            <div class="menu-box" id="menu">
                <div class="input-area">
                    <h2>何を送りますか？</h2>
                    <div id="inclusion"></div>
                </div>
                <!-- <button class="accordion-btn">ダミー：アコーディオンメニューの練習</button>
                <div class="accordion-panel">
                    <p>サイズ直接入力機能は作成中です・・・</p>
                    <input type="text" value="エラー処理めんどうだなあ"/>
                </div> -->
                <div class="input-area" id="envelope">
                    <h2>封筒のサイズは？</h2>
                    <div id="envelope-select"></div>
                </div>
            </div>
            <div class="footer">
                <p>フッター</p>
            </div>
        </div>
        <div class="simulation-area">
            <div class="simu-left">
                <div class="simu-size">
                    <p>サイズ</p>
                    <div id="display-size-area"></div>
                </div>
                <div class="simu-weight">
                    <p>重さ</p>
                    <div id="display-weight-area"></div>
                </div>
                <div class="simu-thickness">
                    <p>厚み</p>
                    <div id="display-thickness-area"></div>
                </div>
            </div>
            <div class="arrow"><p>→</p></div>
            <div class="simu-right">
                <div class="result">
                    <p>結果をここに表示</p>
                    <div id="display-mailtype"></div>
                    <div id="display-postage"></div>
                </div>
            </div>
        </div>
        <script src="javascript.js"></script>
        <script>

            // コンポーネント用の配列
            const components = [
                {id:'NormalPaper', label:'普通紙', weight:55, thickness:0.12, havingSize: true, max: 20},
                {id:'HeavyPaper', label:'厚紙', weight:120, thickness:0.15, havingSize: true, max: 10},
                {id:'Clips', label:'クリップ', weight:0.42, thickness:1.0, havingSize: false, max: 5}
                // コンポーネントを適宜追加
            ]

            // サイズ一覧
            const sizeStandard = {
                'none': {long:' -- ', short:' -- '},
                'A4': {long:297, short:210},
                'B4': {long:364, short:257}
            }    

            // 封筒ボタンのデータセット
            const envelopeData = {
                'K1': {value:"角型１号", long:382, short:270},
                'K2': {value:"角型２号", long:332, short:240},
                'T2': {value:"長型２号", long:277, short:119},
                'T4': {value:"長型４号", long:205, short:90}
            }   
            
            // データ取得
            // const inclusionContainer = document.getElementById('inclusion'); // 内容物
            const envelopeArea = document.getElementById('envelope-select'); // 封筒
            // 出力エリア
            const displaySize = document.getElementById("display-size-area");
            const displayWeight = document.getElementById("display-weight-area");
            const displayThickness = document.getElementById("display-thickness-area");
            const displayMailType = document.getElementById("display-mailtype");
            const displayPostage = document.getElementById("display-postage");
            
            let outerLong, outerShort;
            
            
            // 内容物のクラス
            class Inclusion {
                constructor(key, label, weightStandard, thickness, havingSize, max){
                    this.key = key;
                    this.label = label;
                    this.basicWeight = weightStandard / (788 * 1091);
                    this.totalWeight = 0;
                    this.basicThickness = thickness;
                    this.totalThickness = 0;
                    this.havingSize = havingSize;
                    this.longSide = 0;
                    this.shortSide = 0;
                    this.quantity = 0;
                    this.quantityMax = max;
                    this.createElements(); // インスタンス作成時に画面要素を作成
                    this.attachListeners(); // 作成した画面要素にイベントリスナーを付与
                }

                createElements() {
                    // 要素を配置するdivを定義
                    const div = document.createElement('div');
                    document.getElementById('inclusion').appendChild(div);
        
                    // 内容物のラベル
                    const label = document.createElement('label');
                    label.textContent = this.label;
                    div.appendChild(label);
        
                    // サイズ選択ドロップメニューを作成（サイズないものには非表示）
                    const sizeSelectMenu = document.createElement('select');
                    sizeSelectMenu.id = this.key + '-size'; 
                    if (this.havingSize) {
                        for (const size in sizeStandard) {
                            const option = document.createElement('option');
                            option.value = size;
                            option.text = size;
                            sizeSelectMenu.appendChild(option);
                        }
                    }else{
                        sizeSelectMenu.disabled = true;
                    }
                    div.appendChild(sizeSelectMenu);

                    // 数量選択ドロップメニューを表示
                    const quantityInputMenu = document.createElement('select');
                    quantityInputMenu.id = this.key + '-quantity';
                    for (let i = 0; i <= this.quantityMax; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.text = i;
                        quantityInputMenu.appendChild(option);
                    }
                    div.appendChild(quantityInputMenu);
                    
                    // 二つor三つ折りラジオボタンを表示
                    // const foldInto = document.createElement('input');
                    // foldInto.id = this.key + '-fold';
                    // div.appendChild(foldInto);
                }
                
                attachListeners() {
                // ドロップダウンメニューに変更時のイベントリスナーを設置
                    const paperSizeSelect = document.getElementById(this.key + '-size');
                    const quantitySelect = document.getElementById(this.key + '-quantity');
                    
                    paperSizeSelect.addEventListener('change', this.updateInstance.bind(this));
                    quantitySelect.addEventListener('change', this.updateInstance.bind(this));
                }

                updateInstance() {
                    const paperSizeSelect = document.getElementById(this.key + '-size');
                    const quantitySelect = document.getElementById(this.key + '-quantity');
        
                    const selectedPaperSize = paperSizeSelect.value;
                    const quantity = Number(quantitySelect.value);
                    
                    this.papersize = selectedPaperSize;
                    this.longSide = sizeStandard[this.papersize].long;
                    this.shortSide = sizeStandard[this.papersize].short;
                    
                    this.quantity = quantity;
                    this.totalWeight= (this.basicWeight * this.longSide * this.shortSide * this.quantity).toFixed(1);
                    this.totalThickness = (this.basicThickness * quantity).toFixed(1);
                    
                    outerLong = calculateOuterSize('longSide');
                    outerShort = calculateOuterSize(this.short);
                    console.log(outerLong,outerShort);
                }
            }
            
            // インスタンスから画面要素を作成
            const componentsInstances = components.map(data => new Inclusion(data.id, data.label, data.weight, data.thickness, data.havingSize, data.max));

            // let needOuterSide;

            function calculateOuterSize(side){
                console.log(componentsInstances);
                const outerSide = side;
                // needOuterSide = componentsInstances.reduce((max, instance) => {
                //     return Math.max(max, instance.outerSide);
                // }, -Infinity);
                // return needOuterSide
                return componentsInstances.reduce((max, instance) => {
                    // return Math.max(max, instance.outerSide);
                    return Math.max(max, instance.longSide); // どう代入？
                }, -Infinity);

                // console.log(needOuterSide);
            }


            // inclusionContainer.addEventListener('change', function(event) {
                // getInclusion(); // 内容物の情報を取得
                // updateInclusion(); // 変数に格納
                // generateInclusionArray();　// まだ作ってない
                // calculate(); // サイズなどの計算
                // generateEnvelopeButtons();
            // });    
            
            // function getInclusion(){
            //     if (normalPages.value != 0){
            //         const normalPaperSize = sizeStandard[normalSize.value];
            //         Normal.long = normalPaperSize[0];
            //         Normal.short = normalPaperSize[1];
            //     }else{
            //         Normal.long = 0;
            //         Normal.short = 0;
            //     }
                
            //     if (heavyPages.value != 0){
            //         const heavyPaperSize = sizeStandard[heavySize.value];
            //         Heavy.long = heavyPaperSize[0];
            //         Heavy.short = heavyPaperSize[1];
            //     }else{
            //         Heavy.long = 0;
            //         Heavy.short = 0;
            //     }
            // }    

            // function updateInclusion(){
            //     thickness_1 = Normal.thickness * normalPages.value;
            //     weight_1 = (Normal.weight * normalPages.value / (788 * 1091) * Normal.long * Normal.short).toFixed(2); //四六判から選択サイズに変換する（未完

            //     thickness_2 = Heavy.thickness * heavyPages.value;
            //     weight_2 = (Heavy.weight * heavyPages.value / (788 * 1091) * Heavy.long * Heavy.short).toFixed(2); //四六判から選択サイズに変換する（未完
            // }    
            

            // function calculate() {
            //     if (Normal.long > Heavy.long){
            //         inclLongSide = Normal.long;
            //     }else{
            //         inclLongSide = Heavy.long;
            //     }

            //     if (Normal.short > Heavy.short){
            //         inclShortSide = Normal.short;
            //     }else{
            //         inclShortSide = Heavy.short;
            //     }

            //     inclTotalWeight = Number(weight_1) + Number(weight_2);
            //     displayWeight.textContent = `${inclTotalWeight} g`;
                
            //     inclTotalThicknes = Number(thickness_1) + Number(thickness_2);
            //     displayThickness.textContent = `${inclTotalThicknes} mm`;
            // }    

            function generateEnvelopeButtons() { 
                envelopeArea.innerHTML = ''; // 既存のボタンを削除

                Object.keys(envelopeData).forEach(envelopeId => {
                    const data = envelopeData[envelopeId];
                    if(data.long > inclLongSide && data.short > inclShortSide){
                        const button = document.createElement("button");
                        button.id = envelopeId;
                        button.textContent = `${envelopeData[envelopeId].value}`;
                        button.classList.add('envelope-btn');
                        envelopeArea.appendChild(button);
                    }
                })

            }
            //     const envelopeButtons = document.querySelectorAll('.envelope-btn'); // envelope-btnを取得
            //     envelopeButtons.forEach(btns => btns.addEventListener('click', forResult));
                
            // }


            // 封筒ボタン選択時の処理

            let evlpLongSide, evlpShortSide, totalWeight, totalThickness;

            function forResult(){
                envelopeCalculate();
                postageCalculate();
            }

            function envelopeCalculate(){
                const selectedEnvelopeSize = envelopeData[event.target.id];
                console.log(selectedEnvelopeSize);
                evlpLongSide = selectedEnvelopeSize.long;
                evlpShortSide = selectedEnvelopeSize.short;
                displaySize.textContent = `${evlpLongSide}mm × ${evlpShortSide}mm`;
            }


            // 郵便種別判定処理
            function postageCalculate() {
                if (evlpLongSide <= 340 && evlpShortSide <= 250){
                    if (evlpLongSide <= 235 && evlpShortSide <= 12){
                        displayMailType.textContent = `定形郵便物です`;
                    }else{
                        displayMailType.textContent = `定形外・規格内郵便物です`;
                    }
                }else{
                    displayMailType.textContent = `定形外・規格外郵便物です`;
                }
            }

            
            // // 初期化処理
            // function initialize() { 
            // }
            
            // // 画面読み込み時に初期化処理を行う
            // document.addEventListener('DOMContentLoaded', initialize);
                

        </script>
    </body>
</html>