<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>郵便料金シミュレーション ver0.9</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="header">
            <h3>郵便料金シミュレーション　β版</h3>
        </div>
        <div class="container">
            <div class="menu-box" id="menu">
                <div class="input-area" id="inclusion">
                    <h2>何を送りますか？</h2>
                    <div class="inclusion-1">
                        <h4>普通紙：　</h4>
                        <select id="normalSize">
                            <option value="none">サイズを選択</option>
                            <option value="A4">A4 | 297mm x 210mm</option>
                            <option value="B4">B4 | 364mm x 257mm</option>
                        </select>
                        <select id="normalPages">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select>
                        <p>枚</p>
                    </div>
                    <div class="inclusion-2">
                        <h4>厚紙：　</h4>
                        <select id="heavySize">
                            <option value="none">サイズを選択</option>
                            <option value="A4">A4 | 297mm x 210mm</option>
                            <option value="B4">B4 | 364mm x 257mm</option>
                        </select>
                        <select id="heavyPages">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select>
                        <p>枚</p>
                    </div>
                </div>
                <button class="accordion-btn">ダミー：アコーディオンメニューの練習</button>
                <div class="accordion-panel">
                    <p>サイズ直接入力機能は作成中です・・・</p>
                    <input type="text" value="エラー処理めんどうだなあ"/>
                </div>
                <div class="input-area" id="envelope">
                    <h2>封筒のサイズは？</h2>
                    <div id="envelope-select">
                        <!-- <button class="envelope-btn" id="K1">角形１号</button>
                        <button class="envelope-btn" id="T2">長形２号</button>
                        <button class="envelope-btn" id="T4">長形４号</button> -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <p>フッター</p>
            </div>
        </div>
        <div class="simulation-area">
            <div class="simu-left">
                <div class="simu-size">
                    <p>サイズ</p>
                    <div id="display-size-area"></div>
                </div>
                <div class="simu-weight">
                    <p>重さ</p>
                    <div id="display-weight-area"></div>
                </div>
                <div class="simu-thickness">
                    <p>厚み</p>
                    <div id="display-thickness-area"></div>
                </div>
            </div>
            <div class="arrow"><p>→</p></div>
            <div class="simu-right">
                <div class="result">
                    <p>結果をここに表示</p>
                    <div id="display-mailtype"></div>
                    <div id="display-postage"></div>
                </div>
            </div>
        </div>
        <script src="javascript.js"></script>
        <script>
            // サイズの一覧
            const sizeMap = {
                'none': [' -- ', ' -- '],
                'A4': ['297', '210'],
                'B4': ['364', '257']
            };    

            // 内容物のデータセット
            class Inclusion {
                constructor(long,short,number,isVariable,weight,thickness){
                    this.long = long;
                    this.short = short;
                    this.number = number;
                    this.isVariable = isVariable;
                    this.weight = weight;
                    this.thickness = thickness;
                }
            }

            const Normal = new Inclusion(0,0,0,true,55,0.12); // コピー用紙 55kg
            const Heavy = new Inclusion(0,0,0,true,120,0.15); // 厚紙 120kg
            const ClearFiles = new Inclusion('test'); 
            const Clips = new Inclusion('test');

            // 封筒ボタンのデータセット
            const envelopeData = {
                'K1': {value:"角型１号", long:382, short:270},
                'K2': {value:"角型２号", long:332, short:240},
                'T2': {value:"長型２号", long:277, short:119},
                'T4': {value:"長型４号", long:205, short:90}
            }   
            
            // データ取得
            const inclusionContainer = document.getElementById('inclusion'); // 内容物
            const envelopeArea = document.getElementById('envelope-select'); // 封筒
            // 出力エリア
            const displaySize = document.getElementById("display-size-area");
            const displayWeight = document.getElementById("display-weight-area");
            const displayThickness = document.getElementById("display-thickness-area");
            const displayMailType = document.getElementById("display-mailtype");
            const displayPostage = document.getElementById("display-postage");



            // 内容物変更時の処理
            let thicknes_1, weight_1, thickness_2, weight_2;
            let inclLongSide, inclShortSide, inclTotalWeight, inclTotalThicknes;


            inclusionContainer.addEventListener('change', function(event) {
                getInclusion(); // 内容物の情報を取得
                updateInclusion(); // 変数に格納
                calculate(); // サイズなどの計算
                buttonSelect(); // 封筒ボタンの生成
            });    
            
            function getInclusion(){
                if (normalPages.value != 0){
                    const normalPaperSize = sizeMap[normalSize.value];
                    Normal.long = normalPaperSize[0];
                    Normal.short = normalPaperSize[1];
                }else{
                    Normal.long = 0;
                    Normal.short = 0;
                }
                
                if (heavyPages.value != 0){
                    const heavyPaperSize = sizeMap[heavySize.value];
                    Heavy.long = heavyPaperSize[0];
                    Heavy.short = heavyPaperSize[1];
                }else{
                    Heavy.long = 0;
                    Heavy.short = 0;
                }
            }    

            function updateInclusion(){
                thickness_1 = Normal.thickness * normalPages.value;
                weight_1 = (Normal.weight * normalPages.value / (788 * 1091) * Normal.long * Normal.short).toFixed(2); //四六判から選択サイズに変換する（未完

                thickness_2 = Heavy.thickness * heavyPages.value;
                weight_2 = (Heavy.weight * heavyPages.value / (788 * 1091) * Heavy.long * Heavy.short).toFixed(2); //四六判から選択サイズに変換する（未完
            }    
            

            function calculate() {
                if (Normal.long > Heavy.long){
                    inclLongSide = Normal.long;
                }else{
                    inclLongSide = Heavy.long;
                }

                if (Normal.short > Heavy.short){
                    inclShortSide = Normal.short;
                }else{
                    inclShortSide = Heavy.short;
                }

                inclTotalWeight = Number(weight_1) + Number(weight_2);
                displayWeight.textContent = `${inclTotalWeight} g`;
                
                inclTotalThicknes = Number(thickness_1) + Number(thickness_2);
                displayThickness.textContent = `${inclTotalThicknes} mm`;
            }    

            function buttonSelect() { 
                envelopeArea.innerHTML = ''; // 既存のボタンを削除

                Object.keys(envelopeData).forEach(buttonId => {
                    const data = envelopeData[buttonId];
                    if(data.long > inclLongSide && data.short > inclShortSide){
                        const button = document.createElement("button");
                        button.id = buttonId;
                        button.textContent = `${envelopeData[buttonId].value}`;
                        button.classList.add('envelope-btn');
                        envelopeArea.appendChild(button);
                    }
                })

                const envelopeButtons = document.querySelectorAll('.envelope-btn'); // envelope-btnを取得
                envelopeButtons.forEach(btns => btns.addEventListener('click', forResult));
                
            }


            // 封筒ボタン選択時の処理

            let evlpLongSide, evlpShortSide, totalWeight, totalThickness;

            function forResult(){
                envelopeCalculate();
                postageCalculate();
            }

            function envelopeCalculate(){
                const selectedEnvelopeSize = envelopeData[event.target.id];
                console.log(selectedEnvelopeSize);
                evlpLongSide = selectedEnvelopeSize.long;
                evlpShortSide = selectedEnvelopeSize.short;
                displaySize.textContent = `${evlpLongSide}mm × ${evlpShortSide}mm`;
            }


            // 郵便種別判定処理
            function postageCalculate() {
                if (evlpLongSide <= 340 && evlpShortSide <= 250){
                    if (evlpLongSide <= 235 && evlpShortSide <= 12){
                        displayMailType.textContent = `定形郵便物です`;
                    }else{
                        displayMailType.textContent = `定形外・規格内郵便物です`;
                    }
                }else{
                    displayMailType.textContent = `定形外・規格外郵便物です`;
                }
            }

            
            // 初期化処理
            function initialize() { 
            }
            
            // 画面読み込み時に初期化処理を行う
            document.addEventListener('DOMContentLoaded', initialize);
                

        </script>
    </body>
</html>